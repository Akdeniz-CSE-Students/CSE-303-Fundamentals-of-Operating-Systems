<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPU Scheduling Simülatörü</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600;800&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* Slate 900 */
            color: #e2e8f0;
        }

        .mono {
            font-family: 'JetBrains Mono', monospace;
        }

        .process-card {
            transition: all 0.3s ease;
        }
        .process-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        /* Gantt Chart Animasyonları */
        @keyframes growWidth {
            from { width: 0; }
            to { width: 100%; }
        }

        .gantt-block {
            animation: fadeIn 0.5s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #1e293b;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Navbar -->
    <nav class="bg-slate-900 border-b border-slate-800 p-4 sticky top-0 z-50 backdrop-blur-md bg-opacity-90">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center gap-2">
                <i data-lucide="cpu" class="text-blue-500 w-8 h-8"></i>
                <h1 class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-500">CPU Scheduler Master</h1>
            </div>
            <div class="hidden md:flex gap-6 text-sm font-medium text-slate-400">
                <a href="#simulator" class="hover:text-white transition-colors">Simülatör</a>
                <a href="#criteria" class="hover:text-white transition-colors">Kriterler</a>
                <a href="#algorithms" class="hover:text-white transition-colors">Algoritmalar</a>
            </div>
        </div>
    </nav>

    <main class="flex-grow container mx-auto p-4 md:p-8 space-y-12">

        <!-- Hero Section -->
        <section class="text-center py-10 space-y-4">
            <h2 class="text-4xl md:text-5xl font-extrabold text-white">İşlemci Zamanlamasını <br><span class="text-blue-500">Görerek</span> Öğren</h2>
            <p class="text-slate-400 max-w-2xl mx-auto">
                Chapter 6'nın karmaşık algoritmalarını interaktif bir şekilde deneyimle.
                Süreçleri ekle, algoritmayı seç ve CPU'nun nasıl karar verdiğini izle.
            </p>
            <a href="#simulator" class="inline-block bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-full font-bold transition-all transform hover:scale-105 shadow-lg shadow-blue-500/30">
                Simülasyonu Başlat
            </a>
        </section>

        <!-- SIMULATOR SECTION -->
        <section id="simulator" class="bg-slate-800 rounded-2xl border border-slate-700 shadow-2xl overflow-hidden scroll-mt-24">
            <div class="p-6 border-b border-slate-700 flex flex-col md:flex-row justify-between items-center gap-4">
                <h3 class="text-2xl font-bold flex items-center gap-2">
                    <i data-lucide="play-circle" class="text-green-400"></i>
                    Simülatör
                </h3>

                <!-- Controls -->
                <div class="flex flex-wrap gap-2 justify-center">
                    <button onclick="addProcess()" class="bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors">
                        <i data-lucide="plus"></i> İş Ekle
                    </button>
                    <button onclick="resetSimulation()" class="bg-red-500/20 hover:bg-red-500/30 text-red-400 px-4 py-2 rounded-lg flex items-center gap-2 transition-colors">
                        <i data-lucide="rotate-ccw"></i> Sıfırla
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-0">

                <!-- Input Area -->
                <div class="p-6 border-r border-slate-700 bg-slate-800/50">
                    <h4 class="text-sm font-semibold text-slate-400 uppercase tracking-wider mb-4">Süreç Kuyruğu (Ready Queue)</h4>

                    <div id="processList" class="space-y-3 max-h-[400px] overflow-y-auto custom-scrollbar pr-2">
                        <!-- Process Cards will be injected here -->
                    </div>

                    <div class="mt-6 pt-6 border-t border-slate-700">
                        <label class="block text-xs font-semibold text-slate-400 mb-2">Algoritma Seç</label>
                        <select id="algoSelect" onchange="updateQuantumVisibility()" class="w-full bg-slate-900 border border-slate-600 rounded-lg p-3 text-white focus:ring-2 focus:ring-blue-500 outline-none mb-4">
                            <option value="fcfs">FCFS (First-Come, First-Served)</option>
                            <option value="sjf">SJF (Shortest Job First - Non-Preemptive)</option>
                            <option value="priority">Priority Scheduling (Non-Preemptive)</option>
                            <option value="rr">Round Robin (RR)</option>
                        </select>

                        <div id="quantumInputDiv" class="hidden mb-4 animate-fade-in">
                            <label class="block text-xs font-semibold text-slate-400 mb-2">Time Quantum (ms)</label>
                            <input type="number" id="timeQuantum" value="2" min="1" class="w-full bg-slate-900 border border-slate-600 rounded-lg p-3 text-white focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>

                        <button onclick="runSimulation()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg shadow-lg shadow-green-500/20 transition-all transform active:scale-95 flex justify-center items-center gap-2">
                            <i data-lucide="zap"></i> ÇALIŞTIR
                        </button>
                    </div>
                </div>

                <!-- Visualization Area -->
                <div class="col-span-1 lg:col-span-2 p-6 bg-slate-900 flex flex-col">
                    <h4 class="text-sm font-semibold text-slate-400 uppercase tracking-wider mb-4">Gantt Şeması & Sonuçlar</h4>

                    <!-- Gantt Chart Container -->
                    <div class="mb-8 relative">
                        <div id="ganttChart" class="flex h-24 bg-slate-800 rounded-lg overflow-hidden border border-slate-700 relative">
                            <div class="absolute inset-0 flex items-center justify-center text-slate-500 text-sm">
                                Simülasyonu başlatmak için "Çalıştır"a basın.
                            </div>
                        </div>
                        <!-- Time Markers -->
                        <div id="timeMarkers" class="flex justify-between mt-1 text-xs text-slate-500 font-mono px-1">
                            <!-- Markers injected via JS -->
                        </div>
                    </div>

                    <!-- Stats Grid -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-slate-800 p-4 rounded-xl border border-slate-700 text-center">
                            <div class="text-xs text-slate-400 mb-1">Ort. Bekleme</div>
                            <div id="avgWaitDisplay" class="text-2xl font-bold text-blue-400">0 ms</div>
                        </div>
                        <div class="bg-slate-800 p-4 rounded-xl border border-slate-700 text-center">
                            <div class="text-xs text-slate-400 mb-1">Ort. Tamamlanma</div>
                            <div id="avgTurnaroundDisplay" class="text-2xl font-bold text-purple-400">0 ms</div>
                        </div>
                        <div class="bg-slate-800 p-4 rounded-xl border border-slate-700 text-center">
                            <div class="text-xs text-slate-400 mb-1">CPU Kullanımı</div>
                            <div class="text-2xl font-bold text-green-400">100%</div>
                        </div>
                        <div class="bg-slate-800 p-4 rounded-xl border border-slate-700 text-center">
                            <div class="text-xs text-slate-400 mb-1">Toplam Süre</div>
                            <div id="totalTimeDisplay" class="text-2xl font-bold text-slate-200">0 ms</div>
                        </div>
                    </div>

                    <!-- Log / Explanation -->
                    <div class="flex-grow bg-slate-950 rounded-xl p-4 border border-slate-800 font-mono text-sm overflow-y-auto max-h-[200px] custom-scrollbar">
                        <h5 class="text-slate-500 mb-2 border-b border-slate-800 pb-1">Sistem Günlüğü:</h5>
                        <ul id="logList" class="space-y-1 text-slate-300">
                            <li>> Sistem hazır.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- INFO CARDS (CRITERIA) -->
        <section id="criteria" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 hover:border-blue-500/50 transition-colors">
                <div class="w-12 h-12 bg-blue-500/20 rounded-lg flex items-center justify-center mb-4">
                    <i data-lucide="clock" class="text-blue-400"></i>
                </div>
                <h3 class="text-lg font-bold text-white mb-2">Waiting Time</h3>
                <p class="text-slate-400 text-sm">
                    Bir işin işlemciyi beklerken kuyrukta geçirdiği toplam süre. Bizim <strong>ana hedefimiz</strong> bunu minimize etmek.
                </p>
            </div>
            <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 hover:border-purple-500/50 transition-colors">
                <div class="w-12 h-12 bg-purple-500/20 rounded-lg flex items-center justify-center mb-4">
                    <i data-lucide="rotate-cw" class="text-purple-400"></i>
                </div>
                <h3 class="text-lg font-bold text-white mb-2">Turnaround Time</h3>
                <p class="text-slate-400 text-sm">
                    İşin sisteme girmesinden bitişine kadar geçen toplam süre. (Bekleme + Çalışma).
                </p>
            </div>
            <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 hover:border-green-500/50 transition-colors">
                <div class="w-12 h-12 bg-green-500/20 rounded-lg flex items-center justify-center mb-4">
                    <i data-lucide="bar-chart-2" class="text-green-400"></i>
                </div>
                <h3 class="text-lg font-bold text-white mb-2">Throughput</h3>
                <p class="text-slate-400 text-sm">
                    Birim zamanda tamamlanan iş sayısı. Ne kadar çok, o kadar iyi.
                </p>
            </div>
        </section>

        <!-- ALGORITHMS DETAIL -->
        <section id="algorithms" class="space-y-8 pb-20">
            <h2 class="text-3xl font-bold text-white border-b border-slate-700 pb-4">Algoritmalar</h2>

            <!-- FCFS -->
            <div class="bg-slate-800 rounded-xl p-6 border-l-4 border-blue-500">
                <h3 class="text-xl font-bold text-white mb-2">FCFS (First-Come, First-Served)</h3>
                <p class="text-slate-400 mb-4">Bakkal sırası mantığı. İlk gelen ilk hizmeti alır.</p>
                <div class="bg-slate-900 p-4 rounded-lg text-sm text-slate-300">
                    <p class="mb-2"><strong class="text-red-400">Sorun (Convoy Effect):</strong> Uzun bir iş (CPU Burst yüksek) en başa gelirse, arkadaki kısa işler onu beklemek zorunda kalır. Ortalama bekleme süresi fırlar.</p>
                    <p class="text-xs text-slate-500">Tipi: Non-preemptive (Kesintisiz)</p>
                </div>
            </div>

            <!-- SJF -->
            <div class="bg-slate-800 rounded-xl p-6 border-l-4 border-purple-500">
                <h3 class="text-xl font-bold text-white mb-2">SJF (Shortest Job First)</h3>
                <p class="text-slate-400 mb-4">En kısa işi öne al. Ortalama bekleme süresini <strong>minimize</strong> eden (Optimal) algoritmadır.</p>
                <div class="bg-slate-900 p-4 rounded-lg text-sm text-slate-300">
                    <p class="mb-2"><strong class="text-red-400">Sorun:</strong> Geleceği bilemezsin. Bir işin CPU'da ne kadar kalacağını tahmin etmek zordur (Exponential Averaging kullanılır).</p>
                    <p class="text-xs text-slate-500">Tipi: Preemptive (SRTF) veya Non-preemptive olabilir.</p>
                </div>
            </div>

            <!-- Priority -->
            <div class="bg-slate-800 rounded-xl p-6 border-l-4 border-yellow-500">
                <h3 class="text-xl font-bold text-white mb-2">Priority Scheduling</h3>
                <p class="text-slate-400 mb-4">Her işin bir öncelik (Priority) değeri vardır. (Genelde düşük sayı = yüksek öncelik).</p>
                <div class="bg-slate-900 p-4 rounded-lg text-sm text-slate-300">
                    <p class="mb-2"><strong class="text-red-400">Sorun (Starvation):</strong> Düşük öncelikli işler sonsuza kadar bekleyebilir.</p>
                    <p class="mb-2"><strong class="text-green-400">Çözüm (Aging):</strong> Bekleyen işin önceliğini zamanla artırırsın.</p>
                </div>
            </div>

             <!-- RR -->
             <div class="bg-slate-800 rounded-xl p-6 border-l-4 border-pink-500">
                <h3 class="text-xl font-bold text-white mb-2">Round Robin (RR)</h3>
                <p class="text-slate-400 mb-4">Dönme dolap. Her işe eşit süre (Time Quantum) verilir. Süre bitince iş durdurulur ve kuyruğun sonuna atılır.</p>
                <div class="bg-slate-900 p-4 rounded-lg text-sm text-slate-300">
                    <p class="mb-2"><strong class="text-blue-400">Özellik:</strong> Time-sharing sistemler için en iyisidir. Yanıt süresi (Response Time) iyidir.</p>
                    <p class="text-xs text-slate-500">Tipi: Preemptive (Kesintili)</p>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-slate-950 py-8 border-t border-slate-800 text-center text-slate-500 text-sm">
        <p>CSE303 Operating Systems Study Tool</p>
        <p class="mt-2 text-xs">Based on Chapter 6 Notes.</p>
    </footer>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        lucide.createIcons();

        // --- State Management ---
        let processes = [
            { id: 1, burst: 10, priority: 3, arrival: 0, color: 'bg-blue-500' },
            { id: 2, burst: 4, priority: 1, arrival: 0, color: 'bg-purple-500' },
            { id: 3, burst: 2, priority: 4, arrival: 0, color: 'bg-green-500' }
        ];

        const colors = ['bg-blue-500', 'bg-purple-500', 'bg-green-500', 'bg-yellow-500', 'bg-pink-500', 'bg-red-500', 'bg-indigo-500', 'bg-orange-500'];

        // --- UI Rendering ---
        function renderProcessList() {
            const list = document.getElementById('processList');
            list.innerHTML = '';

            processes.forEach((p, index) => {
                const div = document.createElement('div');
                div.className = 'process-card bg-slate-700 p-3 rounded-lg flex items-center justify-between group';
                div.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full ${p.color} flex items-center justify-center font-bold text-white text-xs shadow-lg">
                            P${p.id}
                        </div>
                        <div>
                            <div class="text-xs text-slate-400">Burst Time</div>
                            <input type="number" value="${p.burst}" onchange="updateProcess(${index}, 'burst', this.value)" min="1"
                                class="w-16 bg-slate-900 border border-slate-600 rounded px-2 py-1 text-xs text-white focus:outline-none focus:border-blue-500">
                        </div>
                        <div>
                            <div class="text-xs text-slate-400">Priority</div>
                            <input type="number" value="${p.priority}" onchange="updateProcess(${index}, 'priority', this.value)" min="1"
                                class="w-12 bg-slate-900 border border-slate-600 rounded px-2 py-1 text-xs text-white focus:outline-none focus:border-blue-500">
                        </div>
                    </div>
                    <button onclick="removeProcess(${index})" class="text-slate-500 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity">
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                    </button>
                `;
                list.appendChild(div);
            });
            lucide.createIcons();
        }

        function addProcess() {
            if(processes.length >= 8) return alert("Maksimum 8 süreç eklenebilir.");
            const newId = processes.length > 0 ? Math.max(...processes.map(p => p.id)) + 1 : 1;
            processes.push({
                id: newId,
                burst: Math.floor(Math.random() * 10) + 1,
                priority: Math.floor(Math.random() * 5) + 1,
                arrival: 0,
                color: colors[processes.length % colors.length]
            });
            renderProcessList();
        }

        function removeProcess(index) {
            processes.splice(index, 1);
            renderProcessList();
        }

        function updateProcess(index, field, value) {
            processes[index][field] = parseInt(value);
        }

        function resetSimulation() {
            processes = [
                { id: 1, burst: 10, priority: 3, arrival: 0, color: 'bg-blue-500' },
                { id: 2, burst: 4, priority: 1, arrival: 0, color: 'bg-purple-500' }
            ];
            renderProcessList();
            document.getElementById('ganttChart').innerHTML = '<div class="absolute inset-0 flex items-center justify-center text-slate-500 text-sm">Simülasyonu başlatmak için "Çalıştır"a basın.</div>';
            document.getElementById('timeMarkers').innerHTML = '';
            document.getElementById('logList').innerHTML = '<li>> Sistem sıfırlandı.</li>';
            resetStats();
        }

        function resetStats() {
            document.getElementById('avgWaitDisplay').innerText = '0 ms';
            document.getElementById('avgTurnaroundDisplay').innerText = '0 ms';
            document.getElementById('totalTimeDisplay').innerText = '0 ms';
        }

        function updateQuantumVisibility() {
            const algo = document.getElementById('algoSelect').value;
            const qDiv = document.getElementById('quantumInputDiv');
            if (algo === 'rr') {
                qDiv.classList.remove('hidden');
            } else {
                qDiv.classList.add('hidden');
            }
        }

        // --- Core Algorithms ---

        function runSimulation() {
            const algo = document.getElementById('algoSelect').value;
            let result = [];
            let copyProcesses = JSON.parse(JSON.stringify(processes)); // Deep copy

            // Basitlik için tüm süreçlerin Arrival Time = 0 kabul ediyoruz (Non-preemptive için)
            // RR için karmaşık bir mantık ekleyeceğiz.

            document.getElementById('logList').innerHTML = `<li>> ${algo.toUpperCase()} Simülasyonu Başlatıldı...</li>`;

            if (algo === 'fcfs') {
                result = runFCFS(copyProcesses);
            } else if (algo === 'sjf') {
                result = runSJF(copyProcesses);
            } else if (algo === 'priority') {
                result = runPriority(copyProcesses);
            } else if (algo === 'rr') {
                const q = parseInt(document.getElementById('timeQuantum').value) || 2;
                result = runRR(copyProcesses, q);
            }

            drawGantt(result);
            calculateStats(result, copyProcesses);
        }

        function runFCFS(procs) {
            // Geldiği gibi (Index sırasına göre)
            let timeline = [];
            let currentTime = 0;
            procs.forEach(p => {
                timeline.push({
                    process: p,
                    start: currentTime,
                    duration: p.burst,
                    end: currentTime + p.burst
                });
                currentTime += p.burst;
            });
            return timeline;
        }

        function runSJF(procs) {
            // Burst time'a göre sırala
            procs.sort((a, b) => a.burst - b.burst);
            return runFCFS(procs); // Sıralandıktan sonra FCFS ile aynı mantık
        }

        function runPriority(procs) {
            // Priority'e göre sırala (Küçük sayı = Yüksek öncelik)
            procs.sort((a, b) => a.priority - b.priority);
            return runFCFS(procs);
        }

        function runRR(procs, quantum) {
            let timeline = [];
            let currentTime = 0;
            let queue = [...procs]; // Kuyruk
            let remainingBursts = {}; // Kalan süreleri tut

            procs.forEach(p => remainingBursts[p.id] = p.burst);

            let maxCycles = 1000; // Sonsuz döngü koruması

            while (queue.length > 0 && maxCycles > 0) {
                maxCycles--;
                let currentP = queue.shift();
                let rem = remainingBursts[currentP.id];

                let executeTime = Math.min(rem, quantum);

                timeline.push({
                    process: currentP,
                    start: currentTime,
                    duration: executeTime,
                    end: currentTime + executeTime,
                    isPartial: rem > quantum // Tamamlanmadıysa
                });

                currentTime += executeTime;
                remainingBursts[currentP.id] -= executeTime;

                if (remainingBursts[currentP.id] > 0) {
                    queue.push(currentP); // Sona at
                }
            }
            return timeline;
        }

        // --- Visualization & Stats ---

        function drawGantt(timeline) {
            const chart = document.getElementById('ganttChart');
            const markers = document.getElementById('timeMarkers');
            const log = document.getElementById('logList');

            chart.innerHTML = '';
            markers.innerHTML = '';

            let totalDuration = timeline[timeline.length - 1].end;

            // Start marker
            markers.innerHTML += `<span>0</span>`;

            timeline.forEach((block, index) => {
                const widthPercent = (block.duration / totalDuration) * 100;

                // Block Elements
                const blockDiv = document.createElement('div');
                blockDiv.className = `h-full ${block.process.color} flex flex-col items-center justify-center text-white font-bold text-xs border-r border-slate-900/20 gantt-block hover:brightness-110 cursor-pointer relative group`;
                blockDiv.style.width = `${widthPercent}%`;
                blockDiv.innerHTML = `
                    <span>P${block.process.id}</span>
                    <span class="text-[10px] opacity-75 font-normal">${block.duration}ms</span>

                    <!-- Tooltip -->
                    <div class="absolute bottom-full mb-2 bg-slate-900 text-white text-xs p-2 rounded opacity-0 group-hover:opacity-100 transition-opacity z-10 whitespace-nowrap pointer-events-none border border-slate-700 shadow-xl">
                        Process ${block.process.id}<br>
                        Start: ${block.start}<br>
                        End: ${block.end}
                    </div>
                `;

                // Animation delay staggered
                blockDiv.style.animationDelay = `${index * 0.1}s`;

                chart.appendChild(blockDiv);

                // Add log
                setTimeout(() => {
                    const li = document.createElement('li');
                    li.innerText = `> T=${block.start}: P${block.process.id} çalışıyor (${block.duration}ms)`;
                    log.appendChild(li);
                    log.scrollTop = log.scrollHeight;
                }, index * 100);

                // End Marker (only if not too crowded, simple logic)
                // markers.innerHTML += `<span style="position:absolute; left: ${block.end/totalDuration * 100}%">${block.end}</span>`; // Absolute positioning is tricky with flex
            });

            // Add final marker manually for clean layout
             const endSpan = document.createElement('span');
             endSpan.innerText = totalDuration;
             markers.appendChild(endSpan);
        }

        function calculateStats(timeline, originalProcs) {
            // Calculation logic for Waiting Time and Turnaround Time
            // Wait Time = Turnaround Time - Burst Time
            // Turnaround Time = Completion Time - Arrival Time (Assuming 0)

            let completionTimes = {};

            timeline.forEach(block => {
                completionTimes[block.process.id] = block.end; // Son görülen bitiş zamanı
            });

            let totalWait = 0;
            let totalTurnaround = 0;

            // Orijinal process listesinden verileri al (Burst time değişmemiş hali)
            // RR'de process nesneleri tekrar ettiği için originalProcs'u baz almalıyız
            // Ancak processList global değişkenimiz güncel. originalProcs parametre olarak burst'ü değişmemiş almalı.
            // Fakat runRR fonksiyonuna kopya gönderdik, orada burst'ler azaldı.
            // Bu yüzden processes global değişkenini kullanabiliriz (kullanıcı değiştirmediyse).

            // Daha güvenli: processes global değişkenindeki burst değerlerini kullan.

            processes.forEach(p => {
                if(completionTimes[p.id]) {
                    let turnaround = completionTimes[p.id] - p.arrival;
                    let wait = turnaround - p.burst;

                    // Round Robin negatif wait fix (eğer mantık hatası varsa 0'la)
                    if(wait < 0) wait = 0;

                    totalTurnaround += turnaround;
                    totalWait += wait;
                }
            });

            const count = processes.length;
            const avgWait = (totalWait / count).toFixed(2);
            const avgTurn = (totalTurnaround / count).toFixed(2);
            const totalTime = timeline[timeline.length - 1].end;

            document.getElementById('avgWaitDisplay').innerText = `${avgWait} ms`;
            document.getElementById('avgTurnaroundDisplay').innerText = `${avgTurn} ms`;
            document.getElementById('totalTimeDisplay').innerText = `${totalTime} ms`;
        }

        // Init
        renderProcessList();
        updateQuantumVisibility();
    </script>
</body>
</html>
